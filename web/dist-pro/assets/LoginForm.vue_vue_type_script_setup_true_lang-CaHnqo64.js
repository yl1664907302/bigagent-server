var g=(u,h,c)=>new Promise((R,n)=>{var a=r=>{try{p(c.next(r))}catch(d){n(d)}},s=r=>{try{p(c.throw(r))}catch(d){n(d)}},p=r=>r.done?R(r.value):Promise.resolve(r.value).then(a,s);p((c=c.apply(u,h)).next())});import{u as z,F as N,a as U}from"./useValidator-B2AzvKX-.js";import{u as q,r as O,d as B,s as S,I as J,t as T,v as Z,w as $,c as G}from"./index-BGZQasTF.js";import{l as H,Z as K,U as t,F as I,r as P,b as Q,w as W,u as w,m as X,M as Y,y as ee,aJ as oe}from"./vue-chunks-QFn3aUvO.js";import{N as te,O as se}from"./element-plus-C3gpGjIx.js";function _(u){return typeof u=="function"||Object.prototype.toString.call(u)==="[object Object]"&&!ee(u)}const re=30,ae="#999",ne="var(--el-color-primary)",me=H({__name:"LoginForm",emits:["to-register"],setup(u,{emit:h}){const{required:c}=U(),R=h,n=q(),a=O(),s=B(),{currentRoute:p,addRoute:r,push:d}=oe(),{t:l}=G(),x={username:[c()],password:[c()]},D=K([{field:"title",colProps:{span:24},formItemProps:{slots:{default:()=>t("h2",{class:"text-2xl font-bold text-center w-[100%]"},[l("login.login")])}}},{field:"username",label:l("login.username"),component:"Input",colProps:{span:24},componentProps:{placeholder:"admin or test"}},{field:"password",label:l("login.password"),component:"InputPassword",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:"admin or test"}},{field:"tool",colProps:{span:24},formItemProps:{slots:{default:()=>{let e;return t(I,null,[t("div",{class:"flex justify-between items-center w-[100%]"},[t(te,{modelValue:f.value,"onUpdate:modelValue":o=>f.value=o,label:l("login.remember"),size:"small"},null),t(se,{type:"primary",underline:!1},_(e=l("login.forgetPassword"))?e:{default:()=>[e]})])])}}}},{field:"login",colProps:{span:24},formItemProps:{slots:{default:()=>{let e,o;return t(I,null,[t("div",{class:"w-[100%]"},[t(S,{loading:b.value,type:"primary",class:"w-[100%]",onClick:V},_(e=l("login.login"))?e:{default:()=>[e]})]),t("div",{class:"w-[100%] mt-15px"},[t(S,{class:"w-[100%]",onClick:M},_(o=l("login.register"))?o:{default:()=>[o]})])])}}}},{field:"other",component:"Divider",label:l("login.otherLogin"),componentProps:{contentPosition:"center"}},{field:"otherIcon",colProps:{span:24},formItemProps:{slots:{default:()=>t(I,null,[t("div",{class:"flex justify-between w-[100%]"},[t(J,{icon:"ant-design:github-filled",size:re,class:"cursor-pointer ant-icon",color:ae,hoverColor:ne,onClick:()=>window.open("https://github.com/yl1664907302/bigagent","_blank")},null)])])}}}]),f=P(a.getRememberMe),A=()=>{const e=a.getLoginInfo;if(e){const{username:o,password:i}=e;L({username:o,password:i})}};Q(()=>{A()});const{formRegister:C,formMethods:F}=z(),{getFormData:k,getElFormExpose:E,setValues:L}=F,b=P(!1),v=P("");W(()=>p.value,e=>{var o;v.value=(o=e==null?void 0:e.query)==null?void 0:o.redirect},{immediate:!0});const V=()=>g(this,null,function*(){const e=yield E();yield e==null?void 0:e.validate(o=>g(this,null,function*(){if(o){b.value=!0;const i=yield k();try{const m=yield T(i);m&&(w(f)?a.setLoginInfo({username:i.username,password:i.password}):a.setLoginInfo(void 0),a.setRememberMe(w(f)),a.setUserInfo(m.data),n.getDynamicRouter?j():(yield s.generateRoutes("static").catch(()=>{}),s.getAddRouters.forEach(y=>{r(y)}),s.setIsAddRouters(!0),d({path:v.value||s.addRouters[0].path})))}finally{b.value=!1}}}))}),j=()=>g(this,null,function*(){const o={roleName:(yield k()).username},i=n.getDynamicRouter&&n.getServerDynamicRouter?yield Z(o):yield $(o);if(i){const m=i.data||[];a.setRoleRouters(m),n.getDynamicRouter&&n.getServerDynamicRouter?yield s.generateRoutes("server",m).catch(()=>{}):yield s.generateRoutes("frontEnd",m).catch(()=>{}),s.getAddRouters.forEach(y=>{r(y)}),s.setIsAddRouters(!0),d({path:v.value||s.addRouters[0].path})}}),M=()=>{R("to-register")};return(e,o)=>(X(),Y(w(N),{schema:D,rules:x,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:w(C)},null,8,["schema","onRegister"]))}});export{me as _};
