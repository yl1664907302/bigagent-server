var ee=Object.defineProperty;var P=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var M=(d,n,o)=>n in d?ee(d,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):d[n]=o,U=(d,n)=>{for(var o in n||(n={}))ae.call(n,o)&&M(d,o,n[o]);if(P)for(var o of P(n))te.call(n,o)&&M(d,o,n[o]);return d};var v=(d,n,o)=>new Promise((_,x)=>{var b=c=>{try{h(o.next(c))}catch(s){x(s)}},w=c=>{try{h(o.throw(c))}catch(s){x(s)}},h=c=>c.done?_(c.value):Promise.resolve(c.value).then(b,w);h((o=o.apply(d,n)).next())});import{h as le,i as ne,j as oe,_ as se}from"./index-BGZQasTF.js";import{G as ie,j as re,b as p,C as E}from"./element-plus-C3gpGjIx.js";import ce from"./form-_q2MnDWw.js";import de from"./form_edit-Bs6L9yxk.js";import{l as pe,r as m,Z as ue,b as me,m as R,p as ge,U as a,O as i,q as S,u as C,S as f,P as _e,M as fe,T as k,B as j,ah as z,ai as g,ar as he}from"./vue-chunks-QFn3aUvO.js";const ye={class:"agent-config-container"},ve={class:"operation-area"},be={class:"pagination-area"},we=pe({__name:"index",setup(d){var n=m(!1),o=m("新增agent配置"),_=m(!1),x=m("编辑agent配置");const b=m({}),w=m(null),h=m([]),c=m(!1),s=ue({currentPage:1,pageSize:5,total:0}),Y=t=>re(t).format("YYYY-MM-DD HH:mm:ss"),y=()=>v(this,null,function*(){try{c.value=!0;const t={page:s.currentPage,pageSize:s.pageSize},e=yield le(t);h.value=e.data.configs,e.data.nums&&(s.total=e.data.nums)}catch(t){console.error("获取数据失败:",t),p.error("获取数据失败，请重试")}finally{c.value=!1}}),L=t=>v(this,null,function*(){try{const u=yield ne({config_id:t});p.success(u.data)}catch(e){console.error("配置下发失败:",e),p.error("配置下发失败，请重试")}}),N=t=>v(this,null,function*(){try{const u=yield oe({config_id:t});p.success(u.data)}catch(e){console.error("配置删除失败:",e),p.error("配置删除失败，请重试")}}),$=t=>{s.pageSize=t,y()},q=t=>{s.currentPage=t,y()},A=()=>{n.value=!0},H=t=>{w.value=U({},t),_.value=!0},V=()=>{p.success("提交成功"),y()},D=()=>{p.success("已重置")},I=t=>v(this,null,function*(){try{yield E.confirm(z("div",null,['确认下发配置 "',t.title,'" 吗？',z("span",{style:{color:"red"}},"范围是所有主机！")]),{title:"下发确认",confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),yield L(t.id)}catch(e){e!=="cancel"&&p({type:"error",message:"下发失败："+e})}finally{yield y(),b.value[t.id]=!1}}),G=t=>v(this,null,function*(){try{yield E.confirm(z("div",null,['确认删除配置 "',t.title,'" 吗？',z("span",{style:{color:"red"}},"删除后无法找回！")]),{title:"删除确认",confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),yield N(t.id)}catch(e){e!=="cancel"&&p({type:"error",message:"删除失败："+e})}finally{b.value[t.id]=!1,y()}}),O={backgroundColor:"#f5f7fa",color:"#606266",fontWeight:"bold",fontSize:"14px",height:"45px",padding:"8px"},W={fontSize:"14px",padding:"8px"};return me(()=>{y()}),(t,e)=>{const u=g("el-button"),r=g("el-table-column"),Z=g("el-tag"),F=g("el-space"),J=g("el-table"),K=g("el-pagination"),Q=g("el-card"),B=g("el-dialog"),X=he("loading");return R(),ge("div",ye,[a(Q,{class:"table-card"},{default:i(()=>[S("div",ve,[a(u,{type:"primary",onClick:A,icon:C(ie)},{default:i(()=>[f(" 新增配置 ")]),_:1},8,["icon"])]),_e((R(),fe(J,{data:h.value,border:"",style:{width:"100%"},"header-cell-style":O,"cell-style":W,"highlight-current-row":"",stripe:""},{default:i(()=>[a(r,{prop:"id",label:"ID","min-width":"60"}),a(r,{prop:"title",label:"配置标题","min-width":"120"}),a(r,{prop:"status",label:"状态","min-width":"80"},{default:i(({row:l})=>[a(Z,{type:l.status==="有效"?"success":"danger"},{default:i(()=>[f(k(l.status),1)]),_:2},1032,["type"])]),_:1}),a(r,{prop:"times",label:"次数","min-width":"80"}),a(r,{prop:"role_name",label:"角色","min-width":"100"}),a(r,{prop:"ranges",label:"范围","min-width":"100"}),a(r,{label:"接口信息","min-width":"150"},{default:i(({row:l})=>[f(k(l.host),1)]),_:1}),a(r,{prop:"auth_name",label:"认证方式","min-width":"100"}),a(r,{prop:"slot_name",label:"槽位","min-width":"100"}),a(r,{prop:"data_name",label:"数据格式","min-width":"100"}),a(r,{prop:"collection_frequency",label:"频次","min-width":"100"}),a(r,{prop:"created_at",label:"创建时间","min-width":"160"},{default:i(({row:l})=>[f(k(Y(l.created_at)),1)]),_:1}),a(r,{label:"操作","min-width":"180",fixed:"right"},{default:i(({row:l})=>[a(F,null,{default:i(()=>[a(u,{size:"small",type:"primary",loading:b.value[l.id],onClick:T=>I(l)},{default:i(()=>[f(" 下发(ALL) ")]),_:2},1032,["loading","onClick"]),a(u,{size:"small",type:"warning",onClick:T=>H(l)},{default:i(()=>[f(" 编辑 ")]),_:2},1032,["onClick"]),a(u,{size:"small",type:"danger",onClick:T=>G(l)},{default:i(()=>[f(" 删除 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[X,c.value]]),S("div",be,[a(K,{"current-page":s.currentPage,"onUpdate:currentPage":e[0]||(e[0]=l=>s.currentPage=l),"page-size":s.pageSize,"onUpdate:pageSize":e[1]||(e[1]=l=>s.pageSize=l),"page-sizes":[5,10,20,50,100],total:s.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:$,onCurrentChange:q,background:""},null,8,["current-page","page-size","total"])])]),_:1}),S("div",null,[a(B,{modelValue:C(n),"onUpdate:modelValue":e[2]||(e[2]=l=>j(n)?n.value=l:n=l),title:C(o),width:"50%","close-on-click-modal":!1,"destroy-on-close":!0},{default:i(()=>[a(ce,{onSubmit:V,onReset:D})]),_:1},8,["modelValue","title"])]),S("div",null,[a(B,{modelValue:C(_),"onUpdate:modelValue":e[4]||(e[4]=l=>j(_)?_.value=l:_=l),title:C(x),width:"50%","close-on-click-modal":!1,"destroy-on-close":!0},{default:i(()=>[a(de,{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=l=>w.value=l),onSubmit:V,onReset:D},null,8,["modelValue"])]),_:1},8,["modelValue","title"])])])}}}),De=se(we,[["__scopeId","data-v-2d6aac10"]]);export{De as default};
