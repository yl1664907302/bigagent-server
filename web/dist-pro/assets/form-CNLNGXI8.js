var P=(l,y,d)=>new Promise((S,_)=>{var f=o=>{try{c(d.next(o))}catch(e){_(e)}},g=o=>{try{c(d.throw(o))}catch(e){_(e)}},c=o=>o.done?S(o.value):Promise.resolve(o.value).then(f,g);c((d=d.apply(l,y)).next())});import{h as T,q as A,_ as K}from"./index-BGZQasTF.js";import{b as h}from"./element-plus-C3gpGjIx.js";import{l as O,r as v,Z,b as $,m as b,p as L,q as r,F as j,a7 as G,P as J,M as U,O as i,U as n,S as C,T as k,ai as p,ar as Q,aK as R,aL as W}from"./vue-chunks-QFn3aUvO.js";const I=l=>(R("data-v-60d70877"),l=l(),W(),l),X={class:"config-form"},Y={class:"selected-hosts-section"},ee=I(()=>r("h4",null,"已选主机",-1)),te={class:"selected-hosts"},ae={class:"config-section"},se=I(()=>r("h4",null,"选择配置",-1)),oe=I(()=>r("span",null,null,-1)),ne={class:"pagination-area"},le={class:"button-area"},ie=O({__name:"form",props:{selectedHosts:{type:Array,required:!0,default:()=>[]},visible:{type:Boolean,default:!1}},emits:["update:visible"],setup(l,{expose:y,emit:d}){const S=l,_=d,f=v([]),g=v(!1),c=v(),o=v(),e=Z({currentPage:1,pageSize:5,total:0}),z=()=>P(this,null,function*(){try{g.value=!0;const t={page:e.currentPage,pageSize:e.pageSize},s=yield T(t);f.value=s.data.configs,e.total=s.data.nums||0}catch(t){console.error("获取配置列表失败:",t),h.error("获取配置列表失败")}finally{g.value=!1}}),q=t=>{c.value=t},F=t=>{e.pageSize=t,z()},H=t=>{e.currentPage=t,z()},V=()=>P(this,null,function*(){var t,s;if(((t=c.value)==null?void 0:t.id)==0){h.warning("请选择要下发的配置");return}try{const u={config_id:(s=c.value)==null?void 0:s.id,uuids:S.selectedHosts.map(x=>x.uuid)};yield A(u),h.success("下发配置成功"),w()}catch(u){console.error("下发配置失败:",u),h.error("下发配置失败")}}),w=()=>{_("update:visible",!1)};return $(()=>{z()}),y({handleSubmit:V,handleCancel:w}),(t,s)=>{const u=p("el-tag"),x=p("el-radio"),m=p("el-table-column"),M=p("el-table"),N=p("el-pagination"),B=p("el-button"),E=Q("loading");return b(),L("div",X,[r("div",Y,[ee,r("div",te,[(b(!0),L(j,null,G(l.selectedHosts,a=>(b(),U(u,{key:a.uuid,class:"host-tag",type:"info"},{default:i(()=>[C(k(a.hostname)+" ("+k(a.ipv4_first)+") ",1)]),_:2},1024))),128))])]),r("div",ae,[se,J((b(),U(M,{data:f.value,border:"",style:{width:"100%"}},{default:i(()=>[n(m,{width:"55",label:"选择"},{default:i(({row:a})=>[n(x,{modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=D=>o.value=D),label:a.id,onChange:D=>q(a)},{default:i(()=>[oe]),_:2},1032,["modelValue","label","onChange"])]),_:1}),n(m,{prop:"id",label:"ID",width:"60"}),n(m,{prop:"title",label:"配置标题","min-width":"120"}),n(m,{prop:"status",label:"状态",width:"80"},{default:i(({row:a})=>[n(u,{type:a.status==="有效"?"success":"danger"},{default:i(()=>[C(k(a.status),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])),[[E,g.value]]),r("div",ne,[n(N,{"current-page":e.currentPage,"onUpdate:currentPage":s[1]||(s[1]=a=>e.currentPage=a),"page-size":e.pageSize,"onUpdate:pageSize":s[2]||(s[2]=a=>e.pageSize=a),"page-sizes":[5,10,20,50],total:e.total,layout:"total, sizes, prev, pager, next",onSizeChange:F,onCurrentChange:H},null,8,["current-page","page-size","total"])])]),r("div",le,[n(B,{onClick:w},{default:i(()=>[C("取消")]),_:1}),n(B,{type:"primary",onClick:V},{default:i(()=>[C("确定")]),_:1})])])}}}),pe=K(ie,[["__scopeId","data-v-60d70877"]]);export{pe as default};
